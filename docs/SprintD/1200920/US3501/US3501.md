# US3501
=======================================

# 1. Requisitos

**US:** As Customer, I want to get the list of questionnaires that the system is asking me to answer and be able to
answer any of those questionnaires.

- **AC1:** The UI should be generated dynamically in accordance to the given questionnaire. I.e. que UI is generated by
  interpreting the input questionnaire.

- **AC2:** The answers should be saved in a raw text format to be further processed/analyzed.

This US contains 2 use cases they are:

- **UC 3.3.2:** View notifications to answer a survey/questionnaire. Customers should be able to get a list of all
  the notifications received to answer a given survey. A customer receives a notification when (s)he meets the target
  audience of a given survey.

- **UC 3.3.3:** Answer a survey/questionnaire. Following a received notification, customers answer the questions of the
  requested questionnaire.

## Questions

> **Question:**
> Dear client,
> Question 1: In regard to the survey rules, can a survey have multiple of them?
>
> Question 2: If multiple rules were chosen for a given survey, would these be used in conjunction or disjunction?
>
>Example: "Having ordered a certain product and be of a certain gender" or "Having ordered a certain product or be of a
> certain gender"
>
> **Answer:**
> Q1 and Q2: It would be nice to specify more than one condition in the same rule and have more than one rule.
>
>Example:
>
>Rule 1 (two conditions): "Having ordered a certain product (C1) and be of a certain gender (C2)".
>
>Rule 2 (one condition): "Living in Porto district".
>
>The target customers would be the ones meeting Rule 1 or Rule 2.
>
>So, you have conjunction inside a rule (C1 and C2) and disjunction between rules (R1 or R2).
>
>At the end of Sprint D, at least one scenario (conjunction or disjunction) must be supported.

> **Question:**
> Dear client,
> Question 1: In regard to the survey rules, can a survey have multiple of them?
>
> Question 2: If multiple rules were chosen for a given survey, would these be used in conjunction or disjunction?
>
>Example: "Having ordered a certain product and be of a certain gender" or "Having ordered a certain product or be of a
> certain gender"
>
> **Answer:**
> Q1 and Q2: It would be nice to specify more than one condition in the same rule and have more than one rule.
>
>Example:
>
>Rule 1 (two conditions): "Having ordered a certain product (C1) and be of a certain gender (C2)".
>
>Rule 2 (one condition): "Living in Porto district".
>
>The target customers would be the ones meeting Rule 1 or Rule 2.
>
>So, you have conjunction inside a rule (C1 and C2) and disjunction between rules (R1 or R2).
>
>At the end of Sprint D, at least one scenario (conjunction or disjunction) must be supported.

# 2. Análise

Analising the requirements, we can see that the user story has 3 core features:

- There is the need of notifiate the user when a survey is available to answer.
- There is the need of answer a survey.
- There is the need of save the answers of the survey in a raw text format.

### Domain Model

![DomainModel](C:\Users\eduar\Desktop\ProjetoIntegrador\lei21_22_s4_2dj_1\Docs\SprintD\1200920\US3501\DM.svg)

In this excerpt we can see that there is the interation between the Customer and the Survey. The survey is directed to a
specific type of customer. The customer is the one that is going to answer the survey.

### System Sequence Diagram

#### Customer Receives a Notification

![SystemSequenceDiagram](C:\Users\eduar\Desktop\ProjetoIntegrador\lei21_22_s4_2dj_1\Docs\SprintD\1200920\US3501\SSD_CustomerReceivesANotification.svg)

#### Customer checks the list of unanswered surveys

![SystemSequenceDiagram](C:\Users\eduar\Desktop\ProjetoIntegrador\lei21_22_s4_2dj_1\Docs\SprintD\1200920\US3501\SSD_CustomerChecksTheListOfUnansweredSurveys.svg)

As we can see, the customer receives a notification when a survey is available to answer. The customer checks the list
of surveys that are available to answer.
Then, in order to answer a survey, there is a loop that iterates over all the questions.

After discussing with the team, we decided:

- The struture of the output file:
  <br>
  TYPE;QUESTION;OPTIONS \n

  ANSWER

  <br>

- The directory where the output file is saved:
    - IdSurvey
        - The filename:
            - Survey[IdSurvey]_[IdCustomer].txt

# 3. Design

## Sequence Diagram (SD)

![SequenceDiagram](C:\Users\eduar\Desktop\ProjetoIntegrador\lei21_22_s4_2dj_1\Docs\SprintD\1200920\US3501\SD.svg)


## Functionality Realization

We are using the following layer structure design:

- Presentation Layer:
  - GenerateStatisticalReportUI

- Domain Layer:
  - Survey

- Application Layer:
  - GenerateStatisticalReportController
  - GenerateStatisticalReportService
  - VerifyIfSurveyExistsService

- Repository Layer:
  - SurveyRepository

## Padrões Aplicados

* GRASP (Information Expert, Creator, Controller, Low Coupling (evaluative), High Cohesion (evaluative), Polymorphism, Pure Fabrication, Indirection, Protected Variations);
  + Information Expert - The service, since has a direct connection with the repositories, in this case, knows all domain concepts from this specific Use Case;
  + Creator, the UI creates the controller, and the controller creates all needed services;
  + Low Coupling and High Cohesion, since we are using a lot of structured layers, all with a specific meaning, we are applying this pattern aswell;
  + Polymorphism, since a domain concept object may have multiple different values;
  + Pure Fabrication, since there is only 1 of each type of class created, meaning, in case of the controller and the UI they are only created one time;
  + The other patterns already were explained by previous points;
* Tell, don't ask;
  + Basic pattern, has a similar function as "Keep it simple", since both patterns apply simple interaction between actor - UI and UI - controller;
* Single Responsibility Principle;
* Intention Revealing Interfaces;
* DDD (Persistence Ignorance, Entity, Value Object, Domain Service, Aggregate, Domain Event, Observer, Events);
  + This pattern was introduced in EAPLI, where we started working with this pattern. It is very important to fully understand this pattern, since it makes an implementation of a domain business concept way easier (and makes it easier to understand to outside people), Entities, value objects, services... All are well explained in the Geral Domain model and the glossary, so I think there is no need to explain this here;
* Repositories pattern;
  + This pattern applies a persistance context using repositories to have an easier communication between the run time system, and a remote database, where it makes the operation between the same atomic and simple transactions;
* Services pattern;
  + This pattern applies both to the domain and the application layer, in this specific Use Case it wasn't used services in the domain layer only in the Application layer, as stated previously to make an easier interaction between CONTROLLER - SERVICE - REPOSITORY;
* Data Transfer Object (DTO) pattern;
  + In order to abstract the entities and value objects from the domain layer or business layer we implement DTOs to abstract the UI Layer from the Domain Layer;



## Tests

````java
    @Test
    void testBuild2(){

            QuestionPrinterFactory questionPrinterFactory=new QuestionPrinterFactory();
            questionPrinterFactory.setType(QuestionType.TEXT);
            Assertions.assertTrue(questionPrinterFactory.build()instanceof FreeTextQuestion);
            }


@Test
    void testBuild3(){
            QuestionPrinterFactory questionPrinterFactory=new QuestionPrinterFactory();
            questionPrinterFactory.setType(QuestionType.OPTION);
            Assertions.assertTrue(questionPrinterFactory.build()instanceof MultipleChoiceQuestion);

            }


@Test
    void testBuild4(){

            QuestionPrinterFactory questionPrinterFactory=new QuestionPrinterFactory();
            questionPrinterFactory.setType(QuestionType.INPUT);
            Assertions.assertTrue(questionPrinterFactory.build()instanceof SingleChoiceQuestion);
            }


@Test
    void testBuild5(){
            QuestionPrinterFactory questionPrinterFactory=new QuestionPrinterFactory();
            questionPrinterFactory.setType(QuestionType.NUMERIC);
            Assertions.assertTrue(questionPrinterFactory.build()instanceof NumericQuestion);
            }


@Test
    void testBuild6(){

            QuestionPrinterFactory questionPrinterFactory=new QuestionPrinterFactory();
            questionPrinterFactory.setType(QuestionType.SCALING);
            Assertions.assertTrue(questionPrinterFactory.build()instanceof ScalingQuestion);
            }


@Test
    void testBuild7(){

            QuestionPrinterFactory questionPrinterFactory=new QuestionPrinterFactory();
            questionPrinterFactory.setType(QuestionType.DECISION);
            Assertions.assertTrue(questionPrinterFactory.build()instanceof DecisionQuestion);
            }


@Test
    void testBuild8(){

            QuestionPrinterFactory questionPrinterFactory=new QuestionPrinterFactory();
            questionPrinterFactory.setType(QuestionType.SORT);
            Assertions.assertTrue(questionPrinterFactory.build()instanceof SortQuestion);
            }


@Test
    void testConstructor(){
            QuestionPrinterFactory questionPrinterFactory=new QuestionPrinterFactory();
            Assertions.assertNotNull(questionPrinterFactory);
            }


@Test
    void testConstructor2(){

            QuestionPrinterFactory actualQuestionPrinterFactory=new QuestionPrinterFactory();
            actualQuestionPrinterFactory.setOptions("Options");
            actualQuestionPrinterFactory.setQuestion("Question");
            actualQuestionPrinterFactory.setType(QuestionType.TEXT);
            QuestionPrinter printer=actualQuestionPrinterFactory.build();
            Assertions.assertEquals("Question",printer.print());

            }
````

# 4. Integração/Demonstração

There were the need of implementing a notification system to notify the user when a survey is available to answer, so
there were modifications in US3001. When the creation of the survey is done, the system should send a notification to
the users that are in the target audience of the survey.

Also, there were the need to update the US3001 since the past implementation didn't fulfill fully the requirements.

The answers of the survey should be saved in a raw text format to be further created statistics about the answers in the
US 3002 (UC 3.3.4).

# 6. Observações

The notification system is not working properly. Right now, the system is not sending the notification to the users. In
order to have a working system, we mocked it, right now the system is seraching for surveys whose target audience is
the same as the user when the user ask to se his notifications.



